<?phpclass result_top_ten extends result {    function make_table(league_table $data) {        $html = '';        for ($i = 1; $i < 5; $i++) {            $where = $data->where . ' AND ftid=' . $i;            $flights = flight::get_all(                array(                    'fid',                    'flight.pid',                    'flight.gid',                    $data->class_table_alias . '.' . $data->class_primary_key . ' AS ClassID',                    $data->class_table_alias . '.name AS p_name',                    $data->S_alias . '.title AS c_name',                    'g.class AS class',                    'g.name AS g_name',                    'coords',                    'g.mid',                    'g.kingpost',                    'did',                    'defined',                    'lid',                    'multi',                    'ftid',                    $data->ScoreType . ' AS score'                ),                array(                    'join' => array(                        "glider g" => "flight.gid=g.gid",                        "club c" => "flight.cid=c.cid",                        "pilot p" => "flight.pid=p.pid",                        'manufacturer gm'=>'g.mid = gm.mid'                    ),                    'where' => $where,                    'order' => 'score DESC',                    'limit' => 10,                    'parameters' => $data->parameters                )            );            if ($flights) {                $html .= '<div class="table_wrapper"><h3>' . flight_type::get_title($i) . ' - ' . $data->year . '</h3>                    <table class="main results">    <thead>        <tr>            <th style="width:20px">Pos</th>                    <th style="width:100px">' . ($data->class_table_alias == 'c' ? 'Name' : 'Glider' ) . '</th>                    <th style="width:70px">' . ($data->class_table_alias == 'c' ? 'Manufacturer' : '' ) . '</th>                    ' . ($data->class_table_alias == 'c' ? '<th style="width:100px">Glider</th>' : '' ) . '                    <th style="width:58px">Score</th>                    <th style="width:300px">Flight Waypoints</th>                </tr>            </thead>';                $count = 0;                //$flights->iterate(function ($flight, $count) use (&$html) {                /** @var flight $flight */                foreach ($flights as $flight) {                    $count++;                    $html .= '<tr>                        <td>' . $count . '</td>                        <td>' . $flight->p_name . '</td>                        <td><a>' . $flight->c_name . '</a></td>                        ' . ($data->class_table_alias == 'c' ? '<td>' . $flight->g_name . '</td>' : '' ) . '                        ' . $flight->to_print()->get() . '                        <td>' . $flight->coords . '</td>';                }                //});            }            $html .= '</table>';            $html .= '</div>';        }        return $html;    }    function sortflights($a, $b) {        if ($a->score == $b->score) {            return 0;        }        return ($a->score > $b->score) ? -1 : 1;    }}